# Regole Cursor per base_laravelpizza

## ⚠️ REGOLA CRITICA - Architettura Frontoffice OBBLIGATORIA

**PER IL FRONTOFFICE (pagine pubbliche), SEGUIRE SEMPRE QUESTA ARCHITETTURA:**

### ❌ VIETATO (Frontoffice)
- **NON creare controller** per pagine pubbliche
- **NON scrivere rotte** in `routes/web.php` o `routes/api.php` per pagine pubbliche
- **NON usare Route::get()** per routing frontoffice

### ✅ OBBLIGATORIO (Frontoffice)
- **Usare Folio** per routing file-based: pagine in `resources/views/pages/*.blade.php` = rotte automatiche
- **Usare Volt** per interattività: `@volt('component-name')` direttamente nelle pagine Folio
- **Usare Filament** SOLO per admin panel (backend)
- **Chiamare Actions** da componenti Volt, non da controller

### Pattern Architetturale
```
Request → Folio (routing) → Blade Page → Volt Component → Action → Service/Model
```

### Esempio Corretto
```blade
{{-- File: Themes/Meetup/resources/views/pages/events.blade.php --}}
{{-- Folio crea automaticamente rotta /events --}}
<x-layouts.app>
    @volt('events')
        @php
            $events = app(\Modules\Meetup\Services\EventService::class)
                ->getUpcomingEvents();
        @endphp
        
        <div>
            @foreach($events as $event)
                <x-event-card :event="$event" />
            @endforeach
        </div>
        
        <button wire:click="register({{ $event->id }})">
            Register
        </button>
    @endvolt
</x-layouts.app>
```

**Questa regola è ASSOLUTAMENTE OBBLIGATORIA per il frontoffice!**

---

## ⚠️ REGOLA CRITICA - Gestione File Markdown OBBLIGATORIA

**OGNI VOLTA CHE CREI O MODIFICHI FILE .md, SEGUIRE SEMPRE QUESTE REGOLE:**

### ✅ OBBLIGATORIO
- **File .md SOLO dentro cartelle docs esistenti**: `Modules/{ModuleName}/docs/` o `Themes/{ThemeName}/docs/`
- **NON creare nuove cartelle docs**: Usare SOLO quelle esistenti
- **Nomi file minuscoli**: Tutti i caratteri minuscoli, NO maiuscole
- **Eccezioni**: Solo `README.md` e `CHANGELOG.md` possono avere maiuscole

### ❌ VIETATO
- **NON creare file .md** fuori dalle cartelle docs
- **NON creare nuove cartelle docs** (usare quelle esistenti)
- **NON usare caratteri maiuscoli** nei nomi file (tranne README.md e CHANGELOG.md)
- **NON creare file** come `DOCUMENTATION_GAPS_ANALYSIS.md` (usare `documentation-gaps-analysis.md`)

### Esempi Corretti
```
✅ Modules/Meetup/docs/documentation-gaps-analysis.md
✅ Modules/Meetup/docs/seo-marketing-plan.md
✅ Modules/Meetup/docs/README.md (eccezione permessa)
✅ Themes/Meetup/docs/logo-implementation-error.md
```

### Esempi Errati
```
❌ laravel/DOCUMENTATION_GAPS_ANALYSIS.md (fuori da docs, maiuscole)
❌ Modules/Meetup/docs/DOCUMENTATION_GAPS_ANALYSIS.md (maiuscole)
❌ Modules/Meetup/docs/SEO-MARKETING-PLAN.md (maiuscole)
❌ Modules/NewModule/docs/new-file.md (cartella docs nuova)
```

### Cartelle Docs Esistenti
- `Modules/{ModuleName}/docs/` - Documentazione moduli
- `Themes/{ThemeName}/docs/` - Documentazione temi
- `laravel/docs_project/` - Documentazione progetto (se esiste)

**Questa regola è ASSOLUTAMENTE OBBLIGATORIA per tutti i file .md!**

---

## ⚠️ REGOLA CRITICA - Controlli Qualità Codice OBBLIGATORI

**OGNI VOLTA CHE MODIFICHI UN FILE PHP, DEVI CONTROLLARLO CON:**

1. **PHPStan livello 10**: `./vendor/bin/phpstan analyse --level=10 path/to/file.php`
2. **PHPMD** (se disponibile): `./vendor/bin/phpmd path/to/file.php text path/to/phpmd.ruleset.xml`
3. **PHPInsights** (se disponibile): `./vendor/bin/phpinsights analyse path/to/file.php`

**NON COMMITARE MAI codice che non passa questi controlli!**

**Questa regola è ASSOLUTAMENTE OBBLIGATORIA e NON deve mai essere ignorata!**

## Workflow Obbligatorio

1. **Modifica il file**
2. **Esegui PHPStan livello 10** - Corregge TUTTI gli errori (NON procedere se ci sono errori)
3. **Esegui PHPMD** - Risolve code smells (se disponibile)
4. **Esegui PHPInsights** - Verifica qualità complessiva (se disponibile)
5. **Commit solo se tutti i controlli passano**

## Verifica Finale

Dopo aver corretto tutti gli errori in un file, esegui:
```bash
./vendor/bin/phpstan analyse --level=10 path/to/file.php
```

Deve restituire: `[OK] No errors`

## Documentazione

Vedi: `laravel/Modules/Xot/docs/code-quality-mandatory-checks.md`

## Esempi di Correzione Comuni

### Errori view-string
```php
/** @var string $view */
$view = app(GetViewAction::class)->execute();
/** @var view-string $view */
return view($view, $params);
```

### Errori factory mixed
```php
/** @var Factory<Model> $factory */
$factory = Model::factory(10);
/** @var \Illuminate\Database\Eloquent\Collection<int, Model> $collection */
$collection = $factory->create([...]);
```

---

## ⚠️ REGOLA CRITICA - Frontend Asset Management OBBLIGATORIA

**OGNI VOLTA CHE MODIFICHI FILE CSS O JAVASCRIPT, DEVI ESEGUIRE:**

```bash
cd /var/www/_bases/base_laravelpizza/laravel/Themes/Meetup
npm run build && npm run copy
```

**Perché**:
- Vite compila i file source (`resources/css/app.css`, `resources/js/app.js`) in asset ottimizzati
- Gli asset devono essere copiati in `public_html/themes/Meetup/` per essere accessibili via web
- **Senza build e copy, le modifiche NON sono visibili nel browser** (`http://127.0.0.1:8000/it`)

**Quando**:
- ✅ Dopo modifiche a `resources/css/app.css`
- ✅ Dopo modifiche a `resources/js/app.js`
- ✅ Prima di testare nel browser
- ✅ Prima di commitare modifiche frontend
- ❌ NON serve durante `npm run dev` (hot reload automatico)

**Documentazione**: `laravel/Themes/Meetup/docs/development-workflow-css-js-changes.md`

**Questa regola è ASSOLUTAMENTE OBBLIGATORIA per vedere modifiche CSS/JS!**

---

## ⚠️ REGOLA CRITICA - Componenti Blade Anonimi con Namespace

**I componenti anonimi registrati con `Blade::anonymousComponentPath()` NON supportano la sintassi namespace esplicita.**

### ❌ ERRATO
```blade
<x-pub_theme::components.layouts.main>
    {{ $slot }}
</x-pub_theme::components.layouts.main>
```

### ✅ CORRETTO
```blade
<x-layouts.main>
    {{ $slot }}
</x-layouts.main>
```

**Perché**:
- `CmsServiceProvider::registerNamespaces()` registra componenti anonimi con `Blade::anonymousComponentPath()`
- I componenti anonimi funzionano solo con sintassi semplice `<x-component-name>`
- La sintassi namespace esplicita cerca classi componenti o view namespace, non componenti anonimi

**Documentazione**: `laravel/Themes/Meetup/docs/pub-theme-component-namespace-error-analysis.md`

**Questa regola è ASSOLUTAMENTE OBBLIGATORIA per componenti anonimi!**

---

## ⚠️ REGOLA CRITICA - Filosofia Migrazioni Laraxot OBBLIGATORIA

**UNA TABELLA = UNA MIGRAZIONE**

**Per modificare una tabella esistente**:
1. **MODIFICARE** direttamente la migrazione originale
2. **AGGIORNARE** il timestamp nel nome del file
3. **NON creare** mai nuove migrazioni separate

### ❌ VIETATO
- Creare `add_column_to_table.php` per aggiungere colonne
- Creare `update_table.php` per modifiche
- Creare più migrazioni per la stessa tabella

### ✅ CORRETTO
- Modificare `create_table.php` originale
- Aggiungere colonne nella sezione `tableUpdate()` con controlli `hasColumn()`
- Aggiornare timestamp: `2025_05_16_221811_create_table.php`

**Principi**:
- **Single Source of Truth**: Una sola fonte di verità per struttura tabella
- **Evoluzione Organica**: La migrazione "cresce" nel tempo
- **Anti-Frammentazione**: Evita esplosione di micro-migrazioni

**Documentazione**: `laravel/Modules/User/docs/laraxot-migration-philosophy.md`

**Questa regola è ASSOLUTAMENTE OBBLIGATORIA per tutte le migrazioni!**

